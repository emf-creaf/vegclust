<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Reshapes community data from individual into stratified form — stratifyvegdata • vegclust</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Reshapes community data from individual into stratified form — stratifyvegdata"><meta name="description" content="Function stratifyvegdata reshapes individual abundance values into species abundance values per size class or combination of size classes. Function as.stratifiedvegdata checks if the input list has appropriate properties and turns it into an object of class 'stratifiedvegdata'."><meta property="og:description" content="Function stratifyvegdata reshapes individual abundance values into species abundance values per size class or combination of size classes. Function as.stratifiedvegdata checks if the input list has appropriate properties and turns it into an object of class 'stratifiedvegdata'."><meta property="og:image" content="https://emf-creaf.github.io/vegclust/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">vegclust</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/MedRegExample.html">Describing vegetation in terms of structure and composition</a></li>
    <li><a class="dropdown-item" href="../articles/VegetationClassification.html">How to use the vegclust package</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/emf-creaf/vegclust/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Reshapes community data from individual into stratified form</h1>
      <small class="dont-index">Source: <a href="https://github.com/emf-creaf/vegclust/blob/HEAD/R/stratifyvegdata.R" class="external-link"><code>R/stratifyvegdata.R</code></a></small>
      <div class="d-none name"><code>stratifyvegdata.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Function <code>stratifyvegdata</code> reshapes individual abundance values into species abundance values per size class or combination of size classes. Function <code>as.stratifiedvegdata</code> checks if the input list has appropriate properties and turns it into an object of class '<code>stratifiedvegdata</code>'.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">stratifyvegdata</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">sizes1</span>,</span>
<span>  sizes2 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  treeSel <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  spcodes <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  plotColumn <span class="op">=</span> <span class="st">"plot"</span>,</span>
<span>  speciesColumn <span class="op">=</span> <span class="st">"species"</span>,</span>
<span>  abundanceColumn <span class="op">=</span> <span class="st">"abundance"</span>,</span>
<span>  size1Column <span class="op">=</span> <span class="st">"size"</span>,</span>
<span>  size2Column <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cumulative <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  counts <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  mergeSpecies <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">as.stratifiedvegdata</span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A data frame containing individual plant data. Individuals are in rows, while measurements are in columns.</p></dd>


<dt id="arg-sizes-">sizes1<a class="anchor" aria-label="anchor" href="#arg-sizes-"></a></dt>
<dd><p>A numerical vector containing the breaks for primary size classes in ascending order.</p></dd>


<dt id="arg-sizes-">sizes2<a class="anchor" aria-label="anchor" href="#arg-sizes-"></a></dt>
<dd><p>A numerical vector containing the breaks for secondary size classes in ascending order.</p></dd>


<dt id="arg-treesel">treeSel<a class="anchor" aria-label="anchor" href="#arg-treesel"></a></dt>
<dd><p>A logical vector specifying which rows in <code>x</code> to be used. By default (<code>treeSel = NULL</code>) all rows are taken.</p></dd>


<dt id="arg-spcodes">spcodes<a class="anchor" aria-label="anchor" href="#arg-spcodes"></a></dt>
<dd><p>A character vector indicating the codes of species to be used for stratification (species codes beyond those appearing in <code>x</code> are possible). If <code>spcodes = NULL</code> then all species in <code>x</code> are used.</p></dd>


<dt id="arg-plotcolumn">plotColumn<a class="anchor" aria-label="anchor" href="#arg-plotcolumn"></a></dt>
<dd><p>The name of the column in <code>x</code> that contains plot identifiers.</p></dd>


<dt id="arg-speciescolumn">speciesColumn<a class="anchor" aria-label="anchor" href="#arg-speciescolumn"></a></dt>
<dd><p>The name of the column in <code>x</code> that contains species names.</p></dd>


<dt id="arg-abundancecolumn">abundanceColumn<a class="anchor" aria-label="anchor" href="#arg-abundancecolumn"></a></dt>
<dd><p>The name of the column in <code>x</code> that contains abundance values.</p></dd>


<dt id="arg-size-column">size1Column<a class="anchor" aria-label="anchor" href="#arg-size-column"></a></dt>
<dd><p>The name of the column in <code>x</code> that contains values for primary size classes.</p></dd>


<dt id="arg-size-column">size2Column<a class="anchor" aria-label="anchor" href="#arg-size-column"></a></dt>
<dd><p>The name of the column in <code>x</code> that contains values for secondary size classes.</p></dd>


<dt id="arg-cumulative">cumulative<a class="anchor" aria-label="anchor" href="#arg-cumulative"></a></dt>
<dd><p>A flag to indicate that cumulative abundance profiles or surfaces are desired.</p></dd>


<dt id="arg-counts">counts<a class="anchor" aria-label="anchor" href="#arg-counts"></a></dt>
<dd><p>A flag to indicate that the output should be individual counts instead of added abundance values.</p></dd>


<dt id="arg-mergespecies">mergeSpecies<a class="anchor" aria-label="anchor" href="#arg-mergespecies"></a></dt>
<dd><p>A flag to indicate that species identity should be ignored. This leads to analyzing the structure of biomass disregarding species identity.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>A logical flag to indicate extra output.</p></dd>


<dt id="arg-x">X<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A list with as many elements as plot records. Each element should be of class 'matrix' or 'data.frame' with species in rows and strata in columns. Furthermore, the number of rows (species) and columns (strata) should be the same for all elements.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Both functions return an object of class '<code>stratifiedvegdata</code>', which is a list of matrices, one for each plot record. Each element (matrix) has as many rows as species and as many columns as size classes (i.e., as many as elements in vector <code>sizes1</code>). Columns are named starting with 'S' and continuing with the size class (stratum) number. If <code>mergeSpecies=TRUE</code> then all matrices have a single row (whose name is <code>"all"</code>). If <code>sizes2</code> and <code>size2Column</code> are supplied to <code>stratifyvegdata</code>, the function returns an object of class '<code>doublestratifiedvegdata</code>', which is a list of arrays, one for each plot record. Each element (array) has three dimensions corresponding to species, primary sizes (number of elements in in vector <code>sizes1</code>) and secondary sizes (number of elements in in vector <code>sizes2</code>). If <code>cumulative=TRUE</code> then the function returns cumulative abundances (see <code><a href="CAP.html">CAP</a></code> and <code><a href="CAS.html">CAS</a></code>).</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>For each individual (row) in <code>x</code>, <code>stratifyvegdata</code> assigns it to the size class (stratum) containing its size. The corresponding abundance value (e.g. crown cover) of the individual is added to the abundance of the corresponding species at the size class (stratum). If <code>sizes2</code> and <code>size2Column</code> are supplied, the function assigns each individual (row) in <code>x</code> to the combination of size classes (e.g. tree height and diameter).</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>De Cáceres, M., Legendre, P. &amp; He, F. (2013) Dissimilarity measurements and the size structure of ecological communities. Methods in Ecology and Evolution 4: 1167-1177.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="https://rdrr.io/r/stats/reshape.html" class="external-link">reshape</a></code>, <code><a href="CAP.html">CAP</a></code>, <code><a href="CAS.html">CAS</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Miquel De Cáceres, CREAF.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Load tree data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">treedata</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Inspect tree data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">treedata</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   plotID species height cover      diam</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1      1       H      4   0.2 1.1328793</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2      1       H      4   0.2 1.1630979</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3      1       H      4   0.2 1.0639817</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4      2       H      4   0.2 1.0959077</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5      2       O      1   0.2 0.7445254</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6      2       H      4   0.2 1.1514505</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Define stratum thresholds (4 strata)</span></span></span>
<span class="r-in"><span><span class="va">heights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">4</span>, by<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">diameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">2</span>, by<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Stratify tree data using heights as structural variable</span></span></span>
<span class="r-in"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu">stratifyvegdata</span><span class="op">(</span><span class="va">treedata</span>, sizes1<span class="op">=</span><span class="va">heights</span>, plotColumn<span class="op">=</span><span class="st">"plotID"</span>,</span></span>
<span class="r-in"><span>                     speciesColumn<span class="op">=</span><span class="st">"species"</span>, size1Column<span class="op">=</span><span class="st">"height"</span>, counts<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Inspect the second plot record</span></span></span>
<span class="r-in"><span><span class="va">X</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [0,0.5] (0.5,1] (1,1.5] (1.5,2] (2,2.5] (2.5,3] (3,3.5] (3.5,4]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> H       0       0       0       0       0       0       0       3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> N       0       0       0       0       0       0       0       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> O       0       2       0       0       0       0       0       0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Stratify tree data using heights as structural variable and cover as abundance</span></span></span>
<span class="r-in"><span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu">stratifyvegdata</span><span class="op">(</span><span class="va">treedata</span>, sizes1<span class="op">=</span><span class="va">heights</span>, plotColumn<span class="op">=</span><span class="st">"plotID"</span>,</span></span>
<span class="r-in"><span>                     speciesColumn<span class="op">=</span><span class="st">"species"</span>, size1Column<span class="op">=</span><span class="st">"height"</span>, </span></span>
<span class="r-in"><span>                     abundanceColumn<span class="op">=</span><span class="st">"cover"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">Y</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [0,0.5] (0.5,1] (1,1.5] (1.5,2] (2,2.5] (2.5,3] (3,3.5] (3.5,4]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> H       0     0.0       0       0       0       0       0     0.6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> N       0     0.0       0       0       0       0       0     0.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> O       0     0.4       0       0       0       0       0     0.0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Stratify tree data using heights and diameters as structural variables</span></span></span>
<span class="r-in"><span><span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu">stratifyvegdata</span><span class="op">(</span><span class="va">treedata</span>, sizes1<span class="op">=</span><span class="va">heights</span>, sizes2<span class="op">=</span><span class="va">diameters</span>, plotColumn<span class="op">=</span><span class="st">"plotID"</span>,</span></span>
<span class="r-in"><span>                     speciesColumn<span class="op">=</span><span class="st">"species"</span>, size1Column<span class="op">=</span><span class="st">"height"</span>, size2Column<span class="op">=</span><span class="st">"diam"</span>,</span></span>
<span class="r-in"><span>                     counts<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">Z</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> , , [0,0.5]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [0,0.5] (0.5,1] (1,1.5] (1.5,2] (2,2.5] (2.5,3] (3,3.5] (3.5,4]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> H       0       0       0       0       0       0       0       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> N       0       0       0       0       0       0       0       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> O       0       0       0       0       0       0       0       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> , , (0.5,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [0,0.5] (0.5,1] (1,1.5] (1.5,2] (2,2.5] (2.5,3] (3,3.5] (3.5,4]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> H       0       0       0       0       0       0       0       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> N       0       0       0       0       0       0       0       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> O       0       2       0       0       0       0       0       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> , , (1,1.5]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [0,0.5] (0.5,1] (1,1.5] (1.5,2] (2,2.5] (2.5,3] (3,3.5] (3.5,4]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> H       0       0       0       0       0       0       0       3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> N       0       0       0       0       0       0       0       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> O       0       0       0       0       0       0       0       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> , , (1.5,2]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [0,0.5] (0.5,1] (1,1.5] (1.5,2] (2,2.5] (2.5,3] (3,3.5] (3.5,4]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> H       0       0       0       0       0       0       0       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> N       0       0       0       0       0       0       0       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> O       0       0       0       0       0       0       0       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Miquel De Cáceres.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer></div>





  </body></html>

