<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Describing vegetation in terms of structure and composition • vegclust</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Describing vegetation in terms of structure and composition">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">vegclust</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/MedRegExample.html">Describing vegetation in terms of structure and composition</a></li>
    <li><a class="dropdown-item" href="../articles/VegetationClassification.html">How to use the vegclust package</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/emf-creaf/vegclust/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Describing vegetation in terms of structure and composition</h1>
                        <h4 data-toc-skip class="author">Miquel De
Cáceres</h4>
            
            <h4 data-toc-skip class="date">2025-05-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/emf-creaf/vegclust/blob/HEAD/vignettes/MedRegExample.Rmd" class="external-link"><code>vignettes/MedRegExample.Rmd</code></a></small>
      <div class="d-none name"><code>MedRegExample.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The aim of this tutorial is to show how to implement the method to
calculate dissimilarities between communities presented in De Caceres et
al (2013). This method allows incorporating both the structure and the
composition of the community in the dissimilary measurement. The
functions needed to carry out computations have been included in package
<code>vegclust</code> so we start by loading the package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://emf-creaf.github.io/vegclust/">vegclust</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="post-fire-vegetation-regeneration-data">Post-fire vegetation regeneration data<a class="anchor" aria-label="anchor" href="#post-fire-vegetation-regeneration-data"></a>
</h2>
<p>In order to illustrate the method we will use a stratified vegetation
data set containing data from 96 stands. The data was obtained to
investigate patterns vegetation regeneration three years after the
impact of a wildfire. Data were collected in 2012 by Miquel De Caceres
and Albert Petit in Horta de Sant Joan (Catalonia, Spain). The R object
is of class <code>stratifiedvegdata</code> (actually a list).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">medreg</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">medreg</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "stratifiedvegdata" "list"</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">medreg</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 96</span></span></code></pre>
<p>The dataset contains 96 stands (list elements), each of them a
data.frame where rows correspond to broad plant functional groups (Pine
trees, Oak trees, Tall shrubs and small trees, Scrubs and small shrubs
and Grass) and columns correspond to vegetation strata (1 to 7). The
upper heights of the vegetation strata are the following (in cm.)
vector:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">strataUp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">50</span>,<span class="fl">100</span>,<span class="fl">300</span>,<span class="fl">600</span>,<span class="fl">1200</span>,<span class="fl">2400</span><span class="op">)</span></span></code></pre></div>
<p>And the width (range of heights) of each stratum is:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">strataWidths</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">30</span>,<span class="fl">50</span>,<span class="fl">200</span>,<span class="fl">300</span>,<span class="fl">600</span>,<span class="fl">1200</span><span class="op">)</span></span></code></pre></div>
<p>Species abundance values are percentage cover values estimated using
cover classes:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">medreg</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##                                1    2  3 4 5 6 7</span></span>
<span><span class="co">## Pine trees                   0.0  0.0  0 0 0 0 0</span></span>
<span><span class="co">## Quercus trees               12.5 25.0  0 0 0 0 0</span></span>
<span><span class="co">## Tall shrubs and small trees  0.0 62.5 25 0 0 0 0</span></span>
<span><span class="co">## Scrubs and small shrubs     12.5 37.5  0 0 0 0 0</span></span>
<span><span class="co">## Grass                       50.0  0.0  0 0 0 0 0</span></span></code></pre>
<p>The data is read as follows. Shrubs reaching stratum 3 (50 - 100 cm)
had a cumulative cover of 25%, while shrubs reaching only stratum 2 (20
- 50 cm) had a cumulative cover of 62.5%. Thus, the observers grouped
plants according to their height and functional group, and estimated the
cover for those groups of plants.</p>
</div>
<div class="section level2">
<h2 id="cumulative-abundance-profiles">Cumulative abundance profiles<a class="anchor" aria-label="anchor" href="#cumulative-abundance-profiles"></a>
</h2>
<p>The <strong>cumulative abundance profile</strong> (CAP) is a function
that takes a value of <em>size</em> as input (here the <em>size</em> is
a vegetation stratum) and returns the cumulative abundance of organisms
(here the cumulative cover value) whose size is <em>equal to</em> or
<em>larger than</em> the input value. In our case, the CAP function is
the cumulative cover of plants reaching the current stratum or higher
strata. Calculations are made using function <code><a href="../reference/CAP.html">CAP()</a></code> of
<code>vegclust</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">medreg.CAP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CAP.html">CAP</a></span><span class="op">(</span><span class="va">medreg</span><span class="op">)</span></span></code></pre></div>
<p>Note that a different CAP is calculated for each functional group and
plot. The structure of the resulting R object is very similar to the
stratified data:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">medreg.CAP</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "CAP"  "list"</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">medreg.CAP</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 96</span></span></code></pre>
<p>If we inspect the first element of the list, we can see the
difference between the original data and the cumulative abundance
profile.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">medreg.CAP</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##                                1    2  3 4 5 6 7</span></span>
<span><span class="co">## Pine trees                   0.0  0.0  0 0 0 0 0</span></span>
<span><span class="co">## Quercus trees               37.5 25.0  0 0 0 0 0</span></span>
<span><span class="co">## Tall shrubs and small trees 87.5 87.5 25 0 0 0 0</span></span>
<span><span class="co">## Scrubs and small shrubs     50.0 37.5  0 0 0 0 0</span></span>
<span><span class="co">## Grass                       50.0  0.0  0 0 0 0 0</span></span></code></pre>
<p>Moreover, it is possible to graphically display the CAP of a given
stand (it may become difficult to interpret when the number of species
is large). For example, we can display the CAP for each functional group
of the first stand (<code>plots="1"</code>):</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">medreg.CAP</span>, plots<span class="op">=</span><span class="st">"1"</span>, sizes<span class="op">=</span><span class="va">strataUp</span>, xlab<span class="op">=</span><span class="st">"Height (cm)"</span>, </span>
<span>     ylab<span class="op">=</span><span class="st">"Cumulative percent cover"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, col<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, lty<span class="op">=</span><span class="fl">1</span>, </span>
<span>       legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Pines"</span>,<span class="st">"Oaks"</span>,<span class="st">"Tall shrubs"</span>,<span class="st">"Scrubs"</span>,<span class="st">"Grass"</span><span class="op">)</span>, </span>
<span>       bty<span class="op">=</span><span class="st">"n"</span><span class="op">)</span></span></code></pre></div>
<p><img src="MedRegExample_files/figure-html/unnamed-chunk-9-1.png" width="480"></p>
<p>In this case the vegetation is a short but dense shrubland. Note that
in the plot we used <code>strataUp</code> to set the x-axis, so that
real heights are adequately represented.</p>
</div>
<div class="section level2">
<h2 id="cumulative-abundance-surfaces">Cumulative abundance surfaces<a class="anchor" aria-label="anchor" href="#cumulative-abundance-surfaces"></a>
</h2>
<p>The concept of cumulative abundance profile can be extended to two
structural variables, which leads to the concept of <strong>cumulative
abundance surface</strong> (CAS). The CAS is a function that takes a the
values of two structural variables (<em>size1</em> and <em>size2</em>)
as input and returns the cumulative abundance of organisms whose size is
<em>equal to</em> or <em>larger than</em> the input values in one of the
structural variables or in both. In the case of forests, natural choices
for structural variables are tree diameter and tree height. Since our
post-fire regeneration dataset only includes one structural variable, we
will illustrate the concept of CASs using a synthetic data set
consisting in a single plot where the species identity, diameter and
height of a hundred trees has been measured. We start by building a
tree-based data set:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pl</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">100</span><span class="op">)</span> <span class="co"># All trees in the same plot</span></span>
<span><span class="va">sp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span> <span class="co"># Random species identity (species 1 or 2)</span></span>
<span><span class="va">h</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">10</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co"># Heights (m)</span></span>
<span><span class="va">d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="fl">150</span>,<span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">100</span>, lambda<span class="op">=</span><span class="va">h</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co"># Diameters (cm)</span></span>
<span><span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>plot<span class="op">=</span><span class="va">pl</span>,species<span class="op">=</span><span class="va">sp</span>, height<span class="op">=</span><span class="va">h</span>,diameter<span class="op">=</span><span class="va">d</span><span class="op">)</span> </span></code></pre></div>
<p>In this example, we will use basal area (m2) as measure of abundance.
We calculate the area (in square meters) of each tree:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span><span class="op">$</span><span class="va">ba</span> <span class="op">=</span> <span class="va">pi</span><span class="op">*</span><span class="op">(</span><span class="va">m</span><span class="op">$</span><span class="va">diameter</span><span class="op">/</span><span class="fl">200</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span></code></pre></div>
<p>This specific data looks as follows:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   plot species   height diameter         ba</span></span>
<span><span class="co">## 1    1       2 6.171464       36 0.10178760</span></span>
<span><span class="co">## 2    1       1 4.382543       22 0.03801327</span></span>
<span><span class="co">## 3    1       1 5.446999       23 0.04154756</span></span>
<span><span class="co">## 4    1       2 5.408527       27 0.05725553</span></span>
<span><span class="co">## 5    1       2 6.373799       42 0.13854424</span></span>
<span><span class="co">## 6    1       2 6.681184       45 0.15904313</span></span></code></pre>
<p>We start our analysis by defining two sets of size classes, one for
height and the other for diameter:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">heights</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span>, by<span class="op">=</span><span class="fl">.25</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="co"># Quadratic classes</span></span>
<span><span class="va">diams</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">150</span>, by<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="co"># Linear classes</span></span></code></pre></div>
<p>We are ready to stratify the data set:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree.S</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/stratifyvegdata.html">stratifyvegdata</a></span><span class="op">(</span><span class="va">m</span>, sizes1<span class="op">=</span><span class="va">heights</span>, sizes2<span class="op">=</span><span class="va">diams</span>, </span>
<span>                   plotColumn <span class="op">=</span> <span class="st">"plot"</span>, speciesColumn <span class="op">=</span> <span class="st">"species"</span>, </span>
<span>                   size1Column <span class="op">=</span> <span class="st">"height"</span>, size2Column <span class="op">=</span> <span class="st">"diameter"</span>, </span>
<span>                   abundanceColumn <span class="op">=</span> <span class="st">"ba"</span><span class="op">)</span></span></code></pre></div>
<p>Function <code><a href="../reference/stratifyvegdata.html">stratifyvegdata()</a></code> is used to reshape data sets
so that they are suitable for calculating CAPs or CASs. In the case of
one structural variable, the function returns a list of matrices, one
for each plot. The post-fire vegetation data presented in the previous
section is an example of this. In the case of two structural variables,
<code><a href="../reference/stratifyvegdata.html">stratifyvegdata()</a></code> returns a list of three-dimensional
arrays, one for each plot. The cumulative abundance surface is then
calculated using function <code>CAS</code>:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree.CAS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CAS.html">CAS</a></span><span class="op">(</span><span class="va">tree.S</span><span class="op">)</span></span></code></pre></div>
<p>We can plot the surface corresponding to each species as follows:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tree.CAS</span>, species<span class="op">=</span><span class="fl">1</span>, sizes1<span class="op">=</span><span class="va">heights</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>, xlab<span class="op">=</span><span class="st">"height (m)"</span>, </span>
<span>     ylab<span class="op">=</span><span class="st">"diameter (cm)"</span>, sizes2<span class="op">=</span><span class="va">diams</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>, zlab<span class="op">=</span><span class="st">"Basal area (m2)"</span>,</span>
<span>     zlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">6</span><span class="op">)</span>, main<span class="op">=</span><span class="st">"Species 1"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tree.CAS</span>, species<span class="op">=</span><span class="fl">2</span>, sizes1<span class="op">=</span><span class="va">heights</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>, xlab<span class="op">=</span><span class="st">"height (m)"</span>, </span>
<span>     ylab<span class="op">=</span><span class="st">"diameter (cm)"</span>, sizes2<span class="op">=</span><span class="va">diams</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>, zlab<span class="op">=</span><span class="st">"Basal area (m2)"</span>,</span>
<span>     zlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">6</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Species 2"</span><span class="op">)</span></span></code></pre></div>
<p><img src="MedRegExample_files/figure-html/unnamed-chunk-16-1.png" width="480"></p>
<p>One nice property of CAS is that its marginal distributions are CAPs.
This can be easily shown if we compare the marginal CAP for height:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="../reference/CAS.html">CASmargin</a></span><span class="op">(</span><span class="va">tree.CAS</span>, margin<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $`1`</span></span>
<span><span class="co">##   [0,0.0625] (0.0625,0.25] (0.25,0.562] (0.562,1] (1,1.56] (1.56,2.25]</span></span>
<span><span class="co">## 1   4.055089      4.055089     4.055089  4.055089 4.055089    4.055089</span></span>
<span><span class="co">## 2   4.708148      4.708148     4.708148  4.708148 4.708148    4.708148</span></span>
<span><span class="co">##   (2.25,3.06] (3.06,4] (4,5.06] (5.06,6.25] (6.25,7.56]  (7.56,9] (9,10.6]</span></span>
<span><span class="co">## 1    4.054068 4.050691 3.989351    3.648646    2.704440 0.5469513        0</span></span>
<span><span class="co">## 2    4.708148 4.693539 4.520830    4.088861    2.684177 1.0380608        0</span></span>
<span><span class="co">##   (10.6,12.2] (12.2,14.1] (14.1,16] (16,18.1] (18.1,20.2] (20.2,22.6] (22.6,25]</span></span>
<span><span class="co">## 1           0           0         0         0           0           0         0</span></span>
<span><span class="co">## 2           0           0         0         0           0           0         0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "CAP"  "list"</span></span></code></pre>
<p>with the CAP directly build using heights:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree.S2</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/stratifyvegdata.html">stratifyvegdata</a></span><span class="op">(</span><span class="va">m</span>, sizes1<span class="op">=</span><span class="va">heights</span>, plotColumn <span class="op">=</span> <span class="st">"plot"</span>, </span>
<span>                         speciesColumn <span class="op">=</span> <span class="st">"species"</span>, size1Column <span class="op">=</span> <span class="st">"height"</span>, </span>
<span>                         abundanceColumn <span class="op">=</span> <span class="st">"ba"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="../reference/CAP.html">CAP</a></span><span class="op">(</span><span class="va">tree.S2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $`1`</span></span>
<span><span class="co">##   [0,0.0625] (0.0625,0.25] (0.25,0.562] (0.562,1] (1,1.56] (1.56,2.25]</span></span>
<span><span class="co">## 1   4.055089      4.055089     4.055089  4.055089 4.055089    4.055089</span></span>
<span><span class="co">## 2   4.708148      4.708148     4.708148  4.708148 4.708148    4.708148</span></span>
<span><span class="co">##   (2.25,3.06] (3.06,4] (4,5.06] (5.06,6.25] (6.25,7.56]  (7.56,9] (9,10.6]</span></span>
<span><span class="co">## 1    4.054068 4.050691 3.989351    3.648646    2.704440 0.5469513        0</span></span>
<span><span class="co">## 2    4.708148 4.693539 4.520830    4.088861    2.684177 1.0380608        0</span></span>
<span><span class="co">##   (10.6,12.2] (12.2,14.1] (14.1,16] (16,18.1] (18.1,20.2] (20.2,22.6] (22.6,25]</span></span>
<span><span class="co">## 1           0           0         0         0           0           0         0</span></span>
<span><span class="co">## 2           0           0         0         0           0           0         0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "CAP"  "list"</span></span></code></pre>
<p>Finally, compare the previous three-dimensional figures, with the
marginal CAP plots for diameters and heights:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/CAS.html">CASmargin</a></span><span class="op">(</span><span class="va">tree.CAS</span>,margin<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, plots<span class="op">=</span><span class="fl">1</span>, sizes<span class="op">=</span><span class="va">heights</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>, </span>
<span>     xlab<span class="op">=</span><span class="st">"height (m)"</span>, ylab<span class="op">=</span><span class="st">"Basal area (m2)"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">7</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/CAS.html">CASmargin</a></span><span class="op">(</span><span class="va">tree.CAS</span>,margin<span class="op">=</span><span class="fl">2</span><span class="op">)</span>, plots<span class="op">=</span><span class="fl">1</span>, sizes<span class="op">=</span><span class="va">diams</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>, </span>
<span>     xlab<span class="op">=</span><span class="st">"diameter (cm)"</span>, ylab<span class="op">=</span><span class="st">"Basal area (m2)"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">7</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="MedRegExample_files/figure-html/unnamed-chunk-19-1.png" width="384"></p>
</div>
<div class="section level2">
<h2 id="dissimilarities-in-structure-and-composition">Dissimilarities in structure and composition<a class="anchor" aria-label="anchor" href="#dissimilarities-in-structure-and-composition"></a>
</h2>
<p>Although CAPs can be used to graphically display the structure and
composition of vegetation stands, the whole point of defining the CAP
function was to allow comparisons between stands. Returning to the
post-fire vegetation regeneration data, we can calculate dissimilarities
for all pairs of stands, thus obtaining a square and symmetric matrix
with dissimilarity values:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">medreg.D</span> <span class="op">=</span> <span class="fu"><a href="../reference/vegdiststruct.html">vegdiststruct</a></span><span class="op">(</span><span class="va">medreg.CAP</span>, method<span class="op">=</span><span class="st">"bray"</span>, </span>
<span>                         classWeights<span class="op">=</span><span class="va">strataWidths</span><span class="op">)</span></span></code></pre></div>
<p>In the above sentence we forced strata to have different weight,
according to the range of heights that each stratum occupies. There are
different alternatives with respect to the dissimilarity index. In our
case we chose the CAP generalization of Bray-Curtis (De Caceres et al
2013). If we want to know, for example, the dissimilarity between stands
<code>1' and</code>2’ we simply write:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">medreg.D</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.2713178</span></span></code></pre>
<p>When calculating dissimilarities it is possible to transform the CAP
values in order to prevent large abundance values to have an undue
influence in the analysis. In our case we choose to take the square root
of cumulative cover values:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">medreg.Dsqrt</span> <span class="op">=</span> <span class="fu"><a href="../reference/vegdiststruct.html">vegdiststruct</a></span><span class="op">(</span><span class="va">medreg.CAP</span>, method<span class="op">=</span><span class="st">"bray"</span>, </span>
<span>                         classWeights<span class="op">=</span><span class="va">strataWidths</span>, transform<span class="op">=</span><span class="st">"sqrt"</span><span class="op">)</span></span></code></pre></div>
<p>We can use metric multidimensional scaling to represent the distances
between stands obtained in both cases:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">X</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/cmdscale.html" class="external-link">cmdscale</a></span><span class="op">(</span><span class="va">medreg.D</span>, k<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">X</span>, xlab<span class="op">=</span><span class="st">"MDS 1"</span>, ylab<span class="op">=</span><span class="st">"MDS 2"</span>, asp<span class="op">=</span><span class="fl">1</span>,</span>
<span>     main<span class="op">=</span><span class="st">"Cover untransformed"</span>, cex<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">Xsqrt</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/cmdscale.html" class="external-link">cmdscale</a></span><span class="op">(</span><span class="va">medreg.Dsqrt</span>, k<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Xsqrt</span>, xlab<span class="op">=</span><span class="st">"MDS 1"</span>, ylab<span class="op">=</span><span class="st">"MDS 2"</span>, asp<span class="op">=</span><span class="fl">1</span>,</span>
<span>     main<span class="op">=</span><span class="st">"Cover sqrt-transformed"</span>, cex<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="MedRegExample_files/figure-html/unnamed-chunk-23-1.png" width="384"></p>
<p>Note that the differences between the two ordination plots are
remarkable.</p>
</div>
<div class="section level2">
<h2 id="classification-of-vegetation-stands">Classification of vegetation stands<a class="anchor" aria-label="anchor" href="#classification-of-vegetation-stands"></a>
</h2>
<p>In this section we use the square-root transformed dissimilarities
between vegetation stands to obtain a classification of the stands in
terms of their structure and composition. If you are not familiarized
with non-hierarchical clustering, you can read the tutorial about
<code>vegclust</code> package. We start by setting the number of
clusters to be found (<code>nclusters</code>) and the size of clusters
(<code>dnoise</code>, a parameter used to leave stands that are far from
all group prototypes unclassified):</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nclusters</span> <span class="op">=</span> <span class="fl">6</span></span>
<span><span class="va">dnoise</span> <span class="op">=</span> <span class="fl">0.40</span></span></code></pre></div>
<p>We call function <code><a href="../reference/vegclust.html">vegclust()</a></code> using the clustering method
<code>"HNCdd"</code>, which indicates (a) hard clustering, (b) medoids
as prototypes, and (c) noise clustering (i.e. excluding outliers in a
special class called <em>noise class</em>):</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vc</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/vegclust.html">vegclustdist</a></span><span class="op">(</span><span class="va">medreg.Dsqrt</span>, mobileMemb <span class="op">=</span> <span class="va">nclusters</span>, </span>
<span>                 method<span class="op">=</span><span class="st">"HNCdd"</span>, dnoise<span class="op">=</span><span class="va">dnoise</span>, nstart<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p>With <code>nstart=100</code> we indicate that the algorithm should be
run 100 times starting from random seeds. This is advisable in order to
maximize the chance of having suboptimal solutions. The prototypes
identified by the algorithm are the following medoids (these are indices
of stands in <code>medreg</code>):</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">medoids</span><span class="op">&lt;-</span><span class="va">vc</span><span class="op">$</span><span class="va">mobileCenters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">medoids</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 60 24 71 20 92 38</span></span></code></pre>
<p>The number of stands belonging to each cluster can be found
using:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cluster</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/defuzzify.html">defuzzify</a></span><span class="op">(</span><span class="va">vc</span><span class="op">)</span><span class="op">$</span><span class="va">cluster</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## cluster</span></span>
<span><span class="co">## M1 M2 M3 M4 M5 M6  N </span></span>
<span><span class="co">##  8 28 15 21  9  7  8</span></span></code></pre>
<p>Note that, because of the model chosen (and with the parameter
<code>dnoise</code>), there are a number of stands that are left
unclassified (i.e. those assigned to class “N”). A useful way to display
the results of the cluster analysis is by showing the stand memberships
to clusters in the ordination:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clNum</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Xsqrt</span>, xlab<span class="op">=</span><span class="st">"MDS 1"</span>, ylab<span class="op">=</span><span class="st">"MDS 2"</span>, </span>
<span>     pch<span class="op">=</span><span class="va">clNum</span>, col<span class="op">=</span><span class="va">clNum</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, col<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">nclusters</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>, pch<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">nclusters</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>       legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span><span class="op">)</span>, bty<span class="op">=</span><span class="st">"n"</span><span class="op">)</span></span></code></pre></div>
<p><img src="MedRegExample_files/figure-html/unnamed-chunk-28-1.png" width="384"></p>
<p>While the stands belonging to <em>true</em> clusters are more or less
close, those that are assigned to the <em>noise</em> can be far appart,
because the only fact that makes them be in the same class is their lack
of membership for <em>true</em> clusters.</p>
<p>To facilitate the interpretation of the clusters we can extract the
cumulative abundance profiles of the cluster medoids:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CAPm</span> <span class="op">=</span> <span class="fu"><a href="../reference/CAP.html">CAPcenters</a></span><span class="op">(</span><span class="va">medreg.CAP</span>, <span class="va">vc</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">CAPm</span><span class="op">)</span></span></code></pre></div>
<p>For example, we can inspect the structure and composition of the
fourth group:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">CAPm</span><span class="op">[[</span><span class="va">n</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>, dig<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                                1    2 3 4 5 6 7</span></span>
<span><span class="co">## Pine trees                   0.0  0.0 0 0 0 0 0</span></span>
<span><span class="co">## Quercus trees               12.5 12.5 0 0 0 0 0</span></span>
<span><span class="co">## Tall shrubs and small trees 37.5 37.5 0 0 0 0 0</span></span>
<span><span class="co">## Scrubs and small shrubs     30.0 30.0 0 0 0 0 0</span></span>
<span><span class="co">## Grass                       62.5  0.0 0 0 0 0 0</span></span></code></pre>
<p>The following displays graphically the CAPs of all six groups of
vegetation stands (code not shown):</p>
<p><img src="MedRegExample_files/figure-html/unnamed-chunk-31-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>De Cáceres, M., Legendre, P., &amp; He, F. 2013. Dissimilarity
measurements and the size structure of ecological communities (D. Faith,
Ed.). Methods in Ecology and Evolution 4: 1167–1177.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Miquel De Cáceres.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
